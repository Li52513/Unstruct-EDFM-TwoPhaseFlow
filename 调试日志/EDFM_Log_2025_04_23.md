# 💻 代码调试日志（EDFM-FVM 渗流模拟）

> 项目名称：基于非结构化网格的EDFM模型实现  
> 日期：2025年04月23日  
> 当前阶段：裂缝段离散系数的计算与集成（`computeDiscreteCoefficients()` 函数）

---

## 🧩 本阶段目标

- [x] 为每个裂缝段计算离散所需的 aW_fr, aE_fr, b_fr, aP_fr 系数
- [x] 根据位置类型（首段/中段/尾段）构建差分格式
- [x] 将裂缝段源项 b_fr 写入宿主单元 `Cell` 的 CI 向量中
- [x] 验证 `k_eff` 公式物理合理性并考虑孔隙率与渗透率加权

---

## 🧠 关键函数及修改点

| 函数名 | 文件 | 修改/定位目的 |
|--------|------|----------------|
| `Fracture::computeDiscreteCoefficients()` | `Fracture.cpp` | 实现离散系数计算与写入 host cell |
| `Cell` 结构 | `Cell.h/cpp` | 添加 `CI`, `CI_belongFraction`, `fracturePressure` 成员 |

---

## 🔍 调试结果记录

### ✅ 正确行为

- 裂缝段根据位置分别计算了 aW/aE，系数逻辑无误；
- `host.CI` 中成功累积了裂缝段源项 b_fr；
- `k_eff` 按照复合介质导流能力表达式加权计算完成，表达合理；
- 输出调试信息确认 `elem.id`, `elem.aW_fr`, `elem.aE_fr`, `elem.b_fr`, `elem.k_eff` 数值连续合理。

### ❌ 问题发现

- [ ] 极小 avgDistance 导致 b_fr 数值过大，建议在分母加入下限截断；
- [ ] 某些单元 `CI` 中的 fracturePressure 为初始值 0.0，需确认 `elem.p_fr` 是否前置初始化或外部赋值。

---

## 🧪 测试用例片段

```cpp
for (auto& elem : elements) {
    std::cout << "FractureElement ID=" << elem.id 
              << ", k_eff=" << elem.k_eff
              << ", aW=" << elem.aW_fr
              << ", aE=" << elem.aE_fr
              << ", b=" << elem.b_fr
              << ", aP=" << elem.aP_fr << std::endl;
}
```

---

## 📈 后续计划

- [ ] 为每个裂缝段设置合理初始压力 p_fr 作为 Dirichlet/Neumann 边界条件接口
- [ ] 添加断裂段与宿主单元 CI 耦合项的图形输出，验证裂缝注入耦合正确性
- [ ] 将离散系数集成到整体线性系统求解模块中

---

_注：本日志为每日调试进度文档的一部分，配合 GMSH 可视化工具和线性系统求解器验证使用。_